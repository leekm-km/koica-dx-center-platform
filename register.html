<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - KOICA DX Center Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav-brand">
                <div class="logo-container">
                    <img src="assets/koica-logo.png" alt="KOICA Logo" class="partner-logo"
                        onerror="this.style.display='none'">
                    <img src="assets/hannam-logo.png" alt="Hannam University Logo" class="partner-logo"
                        onerror="this.style.display='none'">
                </div>
                <div class="brand-text">
                    <div class="brand-name">KOICA DX Center</div>
                    <div class="brand-tagline">Philippines</div>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="programs.html" class="nav-link">Programs</a>
                <a href="talent-pool.html" class="nav-link">Talent Pool</a>
                <a href="career.html" class="nav-link">Careers</a>
                <button class="lang-toggle btn btn-ghost">EN</button>
                <a href="lms.html" class="btn btn-primary nav-login-btn">Login</a>
                <button class="btn btn-outline nav-logout-btn" style="display: none;"
                    onclick="authManager.logout()">Logout</button>
                <span class="nav-user-info" style="display: none; margin-left: 10px;"></span>
            </nav>
            <button class="mobile-toggle">â˜°</button>
        </div>
    </header>

    <!-- Mobile Nav -->
    <div class="mobile-nav">
        <ul class="mobile-menu">
            <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
            <li class="nav-item"><a href="programs.html" class="nav-link">Programs</a></li>
            <li class="nav-item"><a href="talent-pool.html" class="nav-link">Talent Pool</a></li>
            <li class="nav-item"><a href="career.html" class="nav-link">Careers</a></li>
            <li class="nav-cta">
                <button class="btn btn-ghost btn-full lang-toggle" style="margin-bottom: var(--space-2);">EN</button>
                <a href="lms.html" class="btn btn-primary btn-full nav-login-btn">Login</a>
                <button class="btn btn-primary btn-full nav-logout-btn" style="display: none;"
                    onclick="authManager.logout()">Logout</button>
                <span class="nav-user-info" style="display: none; margin: 10px 0;"></span>
            </li>
        </ul>
    </div>

    <main style="margin-top: var(--header-height); padding: var(--space-20) 0;">
        <div class="container">
            <div style="max-width: 500px; margin: 0 auto;">
                <div class="card">
                    <div class="card-header text-center">
                        <h1 class="card-title">Create Account</h1>
                        <p class="card-subtitle">Join the KOICA DX Center community</p>
                    </div>

                    <div class="card-body">
                        <form id="registerForm">
                            <!-- Full Name -->
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" name="fullName" class="form-input" required>
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" name="email" class="form-input" required>
                            </div>

                            <!-- Password -->
                            <div class="form-group">
                                <label class="form-label">Password *</label>
                                <input type="password" name="password" class="form-input" required>
                                <p class="form-helper">At least 8 characters with letters and numbers</p>
                            </div>

                            <!-- Role -->
                            <div class="form-group">
                                <label class="form-label">I am a *</label>
                                <select name="role" class="form-select" required>
                                    <option value="student">Student / Graduate</option>
                                    <option value="employer">Employer</option>
                                    <option value="instructor">Instructor</option>
                                </select>
                            </div>

                            <!-- Track (for students) -->
                            <div class="form-group" id="trackGroup">
                                <label class="form-label">Track</label>
                                <select name="track" class="form-select">
                                    <option value="">Select your track</option>
                                    <option value="1">Track 1: Foundation</option>
                                    <option value="2">Track 2: Advanced</option>
                                    <option value="3">Track 3: Train the Trainer</option>
                                </select>
                            </div>

                            <!-- Batch (for students) -->
                            <div class="form-group" id="batchGroup">
                                <label class="form-label">Batch</label>
                                <input type="text" name="batch" class="form-input" placeholder="e.g., 1, 2, 3...">
                            </div>

                            <!-- Company Name (for employers) -->
                            <div class="form-group" id="companyGroup" style="display: none;">
                                <label class="form-label">Company Name *</label>
                                <input type="text" name="companyName" class="form-input"
                                    placeholder="e.g., Samsung Electronics">
                            </div>

                            <!-- Job Position (for employers) -->
                            <div class="form-group" id="positionGroup" style="display: none;">
                                <label class="form-label">Your Position/Role *</label>
                                <input type="text" name="jobPosition" class="form-input"
                                    placeholder="e.g., HR Manager, Recruiter">
                            </div>

                            <!-- Company Website (for employers) -->
                            <div class="form-group" id="websiteGroup" style="display: none;">
                                <label class="form-label">Company Website</label>
                                <input type="url" name="companyWebsite" class="form-input"
                                    placeholder="https://company.com">
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-primary btn-full">
                                Create Account
                            </button>
                        </form>
                    </div>

                    <div class="card-footer" style="justify-content: center;">
                        <p style="color: var(--color-text-secondary);">
                            Already have an account?
                            <a href="lms.html"
                                style="color: var(--color-primary); text-decoration: none; font-weight: 600;">Login</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/i18n.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('registerForm');
            const roleSelect = form.querySelector('[name="role"]');
            const trackGroup = document.getElementById('trackGroup');
            const batchGroup = document.getElementById('batchGroup');
            const companyGroup = document.getElementById('companyGroup');
            const positionGroup = document.getElementById('positionGroup');
            const websiteGroup = document.getElementById('websiteGroup');

            // Show/hide fields based on role
            roleSelect.addEventListener('change', (e) => {
                const role = e.target.value;
                const isStudent = role === 'student';
                const isEmployer = role === 'employer';

                trackGroup.style.display = isStudent ? 'block' : 'none';
                batchGroup.style.display = isStudent ? 'block' : 'none';

                companyGroup.style.display = isEmployer ? 'block' : 'none';
                positionGroup.style.display = isEmployer ? 'block' : 'none';
                websiteGroup.style.display = isEmployer ? 'block' : 'none';

                // Set required attribute
                const companyInput = companyGroup.querySelector('input');
                const positionInput = positionGroup.querySelector('input');
                if (isEmployer) {
                    companyInput.setAttribute('required', 'required');
                    positionInput.setAttribute('required', 'required');
                } else {
                    companyInput.removeAttribute('required');
                    positionInput.removeAttribute('required');
                }
            });

            // Trigger initial state
            roleSelect.dispatchEvent(new Event('change'));

            // Handle form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(form);
                const data = {
                    fullName: formData.get('fullName'),
                    email: formData.get('email'),
                    password: formData.get('password'),
                    role: formData.get('role')
                };

                // Add track and batch only for students
                if (data.role === 'student') {
                    const track = formData.get('track');
                    const batch = formData.get('batch');
                    if (track) data.track = parseInt(track);
                    if (batch) data.batch = batch;
                }

                // Add company info only for employers
                if (data.role === 'employer') {
                    data.companyName = formData.get('companyName');
                    data.jobPosition = formData.get('jobPosition');
                    data.companyWebsite = formData.get('companyWebsite');
                }

                try {
                    // Show loading state
                    const submitBtn = form.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Creating account...';
                    submitBtn.disabled = true;

                    // Register user
                    await authManager.register(data);

                    // Redirect to homepage or dashboard
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);

                } catch (error) {
                    console.error('Registration error:', error);
                    // Reset button
                    const submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.textContent = 'Create Account';
                    submitBtn.disabled = false;
                }
            });
        });
    </script>
</body>

</html>